# SDMS Deployment Setup Guide

This guide explains how to set up deployment for both applications using GitHub Secrets and free hosting platforms.

## Overview

- **SDMS.B2CWebApp** (Frontend) → Deploy to **Vercel**
- **SDMS.AuthenticationWebApp** (Backend) → Deploy to **Railway**

## Free Key Vault Alternatives

### Option 1: GitHub Secrets (Recommended - Free)
- Built into GitHub
- Secure storage for sensitive data
- Easy to use with GitHub Actions
- No additional cost

### Option 2: Platform Environment Variables
- Vercel: Built-in environment variables
- Railway: Built-in environment variables
- Both platforms provide secure storage

### Option 3: Free Key Vault Services
- **HashiCorp Vault** (Self-hosted free tier)
- **AWS Secrets Manager** (Free tier: 10,000 API calls/month)
- **Azure Key Vault** (Free tier: 10,000 transactions/month)

## SDMS.B2CWebApp (Frontend) - Vercel Setup

### 1. Create Vercel Account
1. Go to [vercel.com](https://vercel.com)
2. Sign up with GitHub
3. Create a new project

### 2. Get Vercel Credentials
1. Go to Settings → Tokens
2. Create a new token → Copy to GitHub Secret `VERCEL_TOKEN`
3. In project settings, find:
   - Organization ID → GitHub Secret `VERCEL_ORG_ID`
   - Project ID → GitHub Secret `VERCEL_PROJECT_ID`

### 3. Set GitHub Secrets
Go to GitHub repository → Settings → Secrets and variables → Actions:

```
API_URL=https://your-auth-app.railway.app
AUTH_SERVER=https://your-auth-app.railway.app
CLIENT_ID=sdms_frontend
VERCEL_TOKEN=your-vercel-token
VERCEL_ORG_ID=your-org-id
VERCEL_PROJECT_ID=your-project-id
```

### 4. Alternative: Netlify (Free)
If you prefer Netlify:
- Similar setup to Vercel
- Free tier available
- GitHub integration
- Update workflow to use Netlify action

## SDMS.AuthenticationWebApp (Backend) - Railway Setup

### 1. Create Railway Account
1. Go to [railway.app](https://railway.app)
2. Sign up with GitHub
3. Create a new project

### 2. Add PostgreSQL Database
1. In Railway project, click "New"
2. Select "PostgreSQL"
3. Railway auto-generates `POSTGRES_CONNECTION` environment variable

### 3. Get Railway Credentials
1. Install Railway CLI: `npm install -g @railway/cli`
2. Login: `railway login`
3. Get token: Create in Railway dashboard → Settings → Tokens
4. Get Project ID: From project settings
5. Get Service ID: From service settings

### 4. Set GitHub Secrets
Go to GitHub repository → Settings → Secrets and variables → Actions:

```
RAILWAY_TOKEN=your-railway-token
RAILWAY_PROJECT_ID=your-project-id
RAILWAY_SERVICE_ID=your-service-id
```

### 5. Set Railway Environment Variables
In Railway dashboard → Variables tab, add:

```
POSTGRES_CONNECTION=<auto-generated by Railway PostgreSQL plugin>
Authentication__LoginUrl=/login
Authentication__LogoutUrl=/logout
Authentication__ErrorUrl=/login
ExternalAuth__Google__ClientId=your-google-client-id
ExternalAuth__Google__ClientSecret=your-google-client-secret
Frontend__Url=https://your-frontend.vercel.app
Webhook__Secret=your-webhook-secret
```

**Note:** Use double underscore `__` for nested configuration keys in environment variables.

### 6. Alternative: Render (Free)
If you prefer Render:
- Similar to Railway
- Free tier available
- PostgreSQL included
- Update workflow to use Render API

## Configuration Priority

### Frontend (Angular)
1. Environment variables at build time (from GitHub Secrets)
2. `environment.prod.ts` (default values)

### Backend (.NET)
1. Environment variables (highest priority)
2. `appsettings.Production.json`
3. `appsettings.json` (fallback)

## Deployment Workflow

### Automatic Deployment
- Push to `main` or `master` branch triggers deployment
- GitHub Actions runs the workflow
- Secrets are injected during build
- Application deploys to respective platform

### Manual Deployment
See individual README files in each project folder.

## Security Best Practices

1. **Never commit secrets** to repository
2. **Use GitHub Secrets** for sensitive data
3. **Rotate secrets** regularly
4. **Use different secrets** for dev/staging/production
5. **Enable 2FA** on GitHub and deployment platforms

## Troubleshooting

### Frontend Build Fails
- Check GitHub Secrets are set correctly
- Verify environment variables in Vercel dashboard
- Check build logs in GitHub Actions

### Backend Deployment Fails
- Verify Railway token is valid
- Check PostgreSQL connection string
- Verify all required environment variables are set
- Check Railway deployment logs

## Next Steps

1. Set up GitHub Secrets
2. Create accounts on Vercel and Railway
3. Configure environment variables
4. Push to main branch to trigger deployment
5. Monitor deployment in GitHub Actions

For detailed instructions, see:
- `SDMS.B2CWebApp/README_DEPLOYMENT.md`
- `SDMS.AuthenticationWebApp/README_DEPLOYMENT.md`

